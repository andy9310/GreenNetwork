from stable_baselines3 import PPO
from linecard_env import LinecardEnv

if __name__ == "__main__":
    # Initialize environment
    switches = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17]
    hosts = [f"h{h}" for h in range(1, 18)]
    links = {
            (1, 2): 1000, (2, 1): 1000, (1, 3): 1000, (3, 1): 1000, (1, 4): 1000, (4, 1): 1000, (1, 9): 1000, (9, 1): 1000, (2, 4): 1000, (4, 2): 1000,
            (2, 9): 1000, (9, 2): 1000, (3, 4): 1000, (4, 3): 1000, (3, 9): 1000, (9, 3): 1000, (4, 5): 1000, (5, 4): 1000, (4, 6): 1000, (6, 4): 1000,
            (4, 7): 1000, (7, 4): 1000, (4, 8): 1000, (8, 4): 1000, (4, 9): 1000, (9, 4): 1000, (4, 10): 1000, (10, 4): 1000, (4, 11): 1000, (11, 4): 1000,
            (4, 15): 1000, (15, 4): 1000, (5, 9): 1000, (9, 5): 1000, (6, 15): 1000, (15, 6): 1000, (7, 9): 1000, (9, 7): 1000, (8, 9): 1000, (9, 8): 1000,
            (9, 10): 1000, (10, 9): 1000, (9, 15): 1000, (15, 9): 1000, (10, 12): 1000, (12, 10): 1000, (10, 13): 1000, (13, 10): 1000, (10, 14): 1000,
            (14, 10): 1000, (10, 15): 1000, (15, 10): 1000, (10, 16): 1000, (16, 10): 1000, (10, 17): 1000, (17, 10): 1000, (11, 15): 1000, (15, 11): 1000,
            (12, 15): 1000, (15, 12): 1000, (13, 15): 1000, (15, 13): 1000, (14, 15): 1000, (15, 14): 1000, (15, 16): 1000, (16, 15): 1000,
            (15, 17): 1000, (17, 15): 1000
        }
    port_info = {
            (1, 2): 3, (2, 1): 2,(1, 3): 4, (3, 1): 2,(1, 4): 5, (4, 1): 2,(1, 9): 10, (9, 1): 2,(2, 4): 5, (4, 2): 3,(2, 9): 10, (9, 2): 3,(3, 4): 5, 
            (4, 3): 4,(3, 9): 10, (9, 3): 4,(4, 5): 6, (5, 4): 5,(4, 6): 7, (6, 4): 5,(4, 7): 8, (7, 4): 5,(4, 8): 9, (8, 4): 5,(4, 9): 10, (9, 4): 5,
            (4, 10): 11, (10, 4): 5,(4, 11): 12, (11, 4): 5,(4, 15): 16, (15, 4): 5,(5, 9): 10, (9, 5): 6,(6, 15): 16, (15, 6): 7,(7, 9): 10, (9, 7): 8,
            (8, 9): 10, (9, 8): 9,(9, 10): 11, (10, 9): 10,(9, 15): 16, (15, 9): 10,(10, 12): 13, (12, 10): 11,(10, 13): 14, (13, 10): 11,(10, 14): 15, 
            (14, 10): 11,(10, 15): 16, (15, 10): 11,(10, 16): 17, (16, 10): 11,(10, 17): 18, (17, 10): 11,(11, 15): 16, (15, 11): 12,(12, 15): 16, 
            (15, 12): 13,(13, 15): 16, (15, 13): 14,(14, 15): 16, (15, 14): 15,(15, 16): 17, (16, 15): 16,(15, 17): 18, (17, 15): 16,
        }
    

    env = LinecardEnv(switches, hosts, links, port_info)
    # Train the RL agent
    model = PPO("MlpPolicy", env, verbose=1)
    model.learn(total_timesteps=10000)
    # Save the trained model
    model.save("ppo_linecard")